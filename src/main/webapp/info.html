<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>빌링 :: 대학교 강의실 대여 사이트</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<style>
.nav-item a, .dropdown-item {
	font-size: 13pt;
	padding-top: -6px;
	margin: 0 15px; /* 양쪽 여백 추가 */
	font-weight: bold; /* 텍스트 굵게 */
}

.nav-item:hover, .dropdown-item:hover {
	background-color: #e9ecef; /* 호버 시 배경색 변경 */
	border-radius: 6px; /* 모서리 둥글게 */
}

.navbar-brand:hover {
	background-color: #29b4e3; /* 호버 시 배경색 변경 */
	border-radius: 6px; /* 모서리 둥글게 */
}

#joinBox {
	margin: 100px 0px 200px 0px;
	padding: 50px 200px;
}

#join-button-box {
	text-align: right;
}

#join-title>p {
	font-family: '맑은 고딕', sans-serif;
	text-align: center;
	font-size: 40px;
	font-weight: bold;
	color: blue;
	padding: 0 0 30px 0;
}

.input-group mb-3 {
	margin: 10px 0px;
}

#idDiv, #idDiv2, #passwordDiv, #password2Div, #phoneDiv, #majorDiv,
	#nameDiv {
	color: red;
	font-size: 11pt;
	font-weight: bold;
	padding: 10px 0 10px 20px;
}
</style>
</head>

<body>
	<script>
/*
fetch("./header/header.html")
.then(response => response.text())
.then(data => {
  document.getElementById("header").innerHTML = data;
})
.catch(error => console.error('Error loading header:', error));
*/


fetch("./footer/footer.html")
.then(response => response.text())
.then(data => {
  document.getElementById("footer").innerHTML = data;
})
.catch(error => console.error('Error loading footer:', error));
</script>


	<div id="header"></div>

	<main>

		<div id="joinBox">
			<div id="join-title">
				<p>회원 정보 수정</p>
			</div>
			<div class="input-group mb-3" style="margin: 10px 0px;">
				<div id="title1" style="padding: 6px 15px 0 5px; font-weight: bold;">아이디</div>
				<input id="input-id" name="user_id" type="text" class="form-control"
					placeholder="아이디" aria-label="아이디" aria-describedby="button-addon2"
					disabled>
			</div>

			<div class="input-group mb-3" style="margin: 10px 0px;">
				<div id="title2" style="padding: 6px 15px 0 5px; font-weight: bold;">이름</div>
				<input id="input-name" name="user_name" type="text"
					class="form-control" placeholder="이름" aria-label="아이디"
					aria-describedby="button-addon2">
			</div>
			<div id="nameDiv"></div>

			<div class="input-group mb-3">
				<div id="title3" style="padding: 6px 15px 0 5px; font-weight: bold;">비밀
					번호</div>
				<input type="password" name="user_password" class="form-control"
					placeholder="비밀 번호" aria-label="비밀 번호"
					aria-describedby="button-addon2">
			</div>
			<div id="passwordDiv"></div>
			<div class="input-group mb-3">
				<div id="title4" style="padding: 6px 15px 0 5px; font-weight: bold;">비밀
					번호 확인</div>
				<input type="password" name="user_password2" class="form-control"
					placeholder="비밀 번호 확인" aria-label="비밀 번호 확인"
					aria-describedby="button-addon2">
			</div>
			<div id="password2Div"></div>
			<div class="input-group mb-3">
				<div id="title5" style="padding: 6px 15px 0 5px; font-weight: bold;">전화
					번호</div>
				<input type="text" name="user_phone" class="form-control"
					placeholder="전화 번호" aria-label="전화 번호"
					aria-describedby="button-addon2">
			</div>
			<div id="phoneDiv"></div>
			<div class="input-group mb-3">
				<div class="dropdown">
					<button id="major" name="user_major"
						class="btn btn-secondary dropdown-toggle" type="button"
						data-bs-toggle="dropdown" aria-expanded="false"
						style="background-color: blue">학과 선택</button>
					<ul class="dropdown-menu">
						<li><a class="dropdown-item" href="#" data-value="물리학과">물리학과</a></li>
						<li><a class="dropdown-item" href="#" data-value="화학과">화학과</a></li>
						<li><a class="dropdown-item" href="#" data-value="생물학과">생물학과</a></li>
						<li><a class="dropdown-item" href="#" data-value="지구과학과">지구과학과</a></li>
					</ul>
				</div>

			</div>

			<div id="join-button-box">
				<a class="btn btn-primary" id="change-button" role="button"
					style="width: 150px; margin: 10px 0px;">회원 정보 수정</a> <a
					class="btn btn-primary" id="delete-button" role="button"
					style="width: 100px; margin: 10px 20px;">회원 탈퇴</a>
			</div>
			<div id="modal" class="modal" tabindex="-1">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">안내</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<p>내용 없음</p>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary"
								data-bs-dismiss="modal">확인</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>

	<div id="footer"></div>

	<script src="http://code.jQuery.com/jquery-3.7.1.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>
	<script>
document.querySelectorAll('.dropdown-item').forEach(item => {
    item.addEventListener('click', function(event) {
        event.preventDefault(); // 링크의 기본 동작을 방지합니다.
        
        const selectedValue = this.getAttribute('data-value'); // 선택된 항목의 데이터 속성 값 가져오기
        document.getElementById('major').textContent  =  selectedValue;// 선택된 값을 페이지에 표시
    });
});

$(document).ready(function() {
	 $('#header').load('./header/header.html', function() {
	let value = localStorage.getItem('id');
	if(value != null && value > 0){
		console.log(2);
		   $('#top-info-button').css('visibility', 'visible'); // 보이게
	       $('#top-logout-button').css('visibility', 'visible'); // 보이게
	       $('#top-login-button').css('display', 'none'); // 숨기기
	       $('#top-join-button').css('display', 'none'); // 숨기기
	       
	       $('#top-logout-button').bind('click', function(event){
	    		localStorage.removeItem('id');
	    		window.location.href = './index.html';
	    		console.log("dd");
	    	});
	}
	else{
		console.log(1);
	    $('#top-info-button').css('display', 'none'); // 숨기기
	    $('#top-logout-button').css('display', 'none'); // 숨기기
	    $('#top-login-button').css('visibility', 'visible'); // 보이게
	    $('#top-join-button').css('visibility', 'visible'); // 보이게
	}
	
	   $('#top-borrowform').on('click', function() {
	       // 페이지 이동을 위해서 location.href를 설정
	   window.location.href = './borrowform.html';
		});
		$('#top-index').on('click', function() {
		        // 페이지 이동을 위해서 location.href를 설정
		   window.location.href = './index.html';
		});
		$('#top-login-button').on('click', function() {
		        // 페이지 이동을 위해서 location.href를 설정
		   window.location.href = './login.html';
		});
		
		$('#top-join-button').on('click', function() {
		        // 페이지 이동을 위해서 location.href를 설정
		   window.location.href = './join.html';
		});  
		$('#top-info-button').on('click', function() {
		        // 페이지 이동을 위해서 location.href를 설정
		   window.location.href = './info.html';
		});
	});
	 let value = localStorage.getItem('id');
	 
	 $.post({	url : './jsp/info.jsp',
			   data : { 'id': value  },
			   dataType: 'json',
			   success: function(data, textStatus, jqXHR) {
				  console.log(data);
			
				   if (jqXHR.status === 200) { // HTTP 200 OK
						$('#input-id').val(data.userId);
						$('input[name="user_password"]').val('');
						$('input[name="user_password2"]').val('');
						$('input[name="user_name"]').val(data.name);
						$('input[name="user_phone"]').val(data.phone);
						$('#major').text(data.major);
				   }
			   },  error: function(data, textStatus, jqXHR) {
					console.log(data);//실패
		}}); 
});

$('#change-button').bind('click', function(event){
	event.preventDefault();
	var user_password = $('input[name="user_password"]').val();
	var user_password2 = $('input[name="user_password2"]').val();
	let value = localStorage.getItem('id');
	if(user_password == null || user_password == "" || user_password2 == null || user_password2 == ""){
		 $('.modal-body > p').text('비밀번호를 입력해주세요.');
		   const modalElement = document.getElementById('modal');
		   const modal = new bootstrap.Modal(modalElement);
		   modal.show();
		   return false;
	}
	if(user_password != user_password2){
		 $('.modal-body > p').text('비밀번호 확인이 서로 일치하지 않습니다.');
		   const modalElement = document.getElementById('modal');
		   const modal = new bootstrap.Modal(modalElement);
		   modal.show();
		   return false;
	}
	$('#nameDiv').empty();
	$('#phone2Div').empty();
	$('#majorDiv').empty();
	
	var user_name = $('input[name="user_name"]').val();
	if(!user_name) {
		$('#nameDiv').text('이름을 입력하세요.');
		$('input[name="user_name"]').focus();
		return false;
	}//if

	var user_phone = $('input[name="user_phone"]').val();
	if(!user_phone) {
		$('#phoneDiv').text('전화번호를 입력하세요.');
		$('input[name="user_phone"]').focus();
		return false;
	}//if

	const user_major = document.getElementById('major').textContent;
	
	$.post(	'./jsp/changeinfo.jsp',
		   { 'id' : value,
		 	 'user_password': user_password,
		 	 'user_name' : user_name,
		 	 'user_phone' : user_phone,
		 	 'user_major' : user_major
			},
			function(data, textStatus, jqXHR) {
			  console.log(data);
		
			   if (jqXHR.status === 200) { // HTTP 200 OK
				   $('.modal-body > p').text('회원 정보가 수정되었습니다.');
				   const modalElement = document.getElementById('modal');
				   const modal = new bootstrap.Modal(modalElement);
				   modal.show();  
				   $('.modal-footer > button').on('click', function(){
					   window.location.href = './index.html';
				   });
				   
			   }
			   
			   
		   }).fail(function(data, textStatus, jqXHR) {
		
			$('.modal-body > p').text('비밀 번호가 일치하지 않습니다.');
			   const modalElement = document.getElementById('modal');
			   const modal = new bootstrap.Modal(modalElement);
			   modal.show();  
			 
	});
});

$('#delete-button').bind('click', function(event){
	event.preventDefault();
	var user_password = $('input[name="user_password"]').val();
	var user_password2 = $('input[name="user_password2"]').val();
	let value = localStorage.getItem('id');
	if(user_password == null || user_password == "" || user_password2 == null || user_password2 == ""){
		 $('.modal-body > p').text('비밀번호를 입력해주세요.');
		   const modalElement = document.getElementById('modal');
		   const modal = new bootstrap.Modal(modalElement);
		   modal.show();
		   return false;
	}
	if(user_password != user_password2){
		 $('.modal-body > p').text('비밀번호 확인이 서로 일치하지 않습니다.');
		   const modalElement = document.getElementById('modal');
		   const modal = new bootstrap.Modal(modalElement);
		   modal.show();
		   return false;
	}
	
	$.post(	'./jsp/deleteid.jsp',
		   { 'id': value,
		 	 'user_password': user_password,
			},
			function(data, textStatus, jqXHR) {
			  console.log(jqXHR.status);
		
			   if (jqXHR.status === 200) { // HTTP 200 OK
				   $('.modal-body > p').text('회원탈퇴에 성공하였습니다.');
				   localStorage.removeItem('id');
				   const modalElement = document.getElementById('modal');
				   const modal = new bootstrap.Modal(modalElement);
				   modal.show();  
				   $('.modal-footer > button').on('click', function(){
					   window.location.href = './index.html';
				   });				   
			   }
			   else{
					$('.modal-body > p').text('비밀 번호가 틀립니다.');
					   const modalElement = document.getElementById('modal');
					   const modal = new bootstrap.Modal(modalElement);
					   modal.show();  
			   }

		   }).fail(function(data, textStatus, jqXHR) {
			$('.modal-body > p').text('비밀 번호가 틀립니다.');
			   const modalElement = document.getElementById('modal');
			   const modal = new bootstrap.Modal(modalElement);
			   modal.show();  
	});
});
</script>
</body>
</html>